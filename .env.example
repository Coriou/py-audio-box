# Vast.ai (required only when WATCHER_EXECUTOR_MODE=vast)
VAST_API_KEY=replace-me
VAST_SSH_KEY=~/.ssh/ssh_key
GHCR_USER=Coriou
GHCR_TOKEN=replace-me
VAST_MAX_DURATION=

# Redis queue
REDIS_URL=redis://127.0.0.1:6379/0

# ── Executor backend ───────────────────────────────────────────────────────────
# WATCHER_EXECUTOR_MODE=vast    → provision Vast GPU, execute remotely (default production)
# WATCHER_EXECUTOR_MODE=local   → run manifest locally, no cloud spend (dev / CI / E2E tests)
WATCHER_EXECUTOR_MODE=vast

# ── Sink backend ───────────────────────────────────────────────────────────────
# WATCHER_SINK_MODE=local   → copy outputs to WATCHER_OUTPUT_ROOT on local disk (default)
# WATCHER_SINK_MODE=rclone  → upload via rclone to S3/Spaces (requires S3_BUCKET + RCLONE_REMOTE)
WATCHER_SINK_MODE=local

# Local sink: deterministic per-topic package root
# Each topic lands at $WATCHER_OUTPUT_ROOT/<topic_id>/job.json + beats/
WATCHER_OUTPUT_ROOT=/work_remote/jobs_out

# rclone sink (only needed when WATCHER_SINK_MODE=rclone):
#
# OPTION A — Local filesystem via rclone (testing):
#   Requires ~/.config/rclone/rclone.conf with:
#       [local]
#       type = local
#   Also create once: mkdir -p work_remote/uploads
#S3_BUCKET=/work_remote/uploads
#RCLONE_REMOTE=local
#S3_PREFIX=voice-results
#
# OPTION B — DigitalOcean Spaces (production rclone path):
#   Add to ~/.config/rclone/rclone.conf:
#       [spaces]
#       type = s3
#       provider = DigitalOcean
#       access_key_id = <your-key>
#       secret_access_key = <your-secret>
#       endpoint = nyc3.digitaloceanspaces.com
#S3_BUCKET=your-bucket-name
#RCLONE_REMOTE=spaces
#S3_PREFIX=voice-results

# Watcher tuning defaults (time values are in seconds unless noted)
WATCHER_POLL_INTERVAL=10        # seconds between idle polls
WATCHER_BATCH_MIN=1             # minimum jobs to trigger a provisioning run
WATCHER_BATCH_MAX_WAIT=300      # seconds — start run even if batch_min not met after this age
WATCHER_BATCH_MAX_JOBS=128      # max jobs leased per batch
WATCHER_IDLE_GRACE=75           # seconds to wait for new jobs before destroying idle instance
WATCHER_MAX_RUNTIME=7200        # seconds — hard cap on a single locked session (2 hours)
WATCHER_MAX_ATTEMPTS=3          # total attempts before permanent failure
WATCHER_LOCK_TTL=120            # seconds — distributed lock TTL (renewed every LOCK_RENEW_EVERY)
WATCHER_LOCK_RENEW_EVERY=40     # seconds — lock renewal interval (must be < LOCK_TTL)
WATCHER_LEASE_IDLE_MS=180000    # milliseconds — PEL entry age before it's considered stale
WATCHER_RSYNC_TIMEOUT=300       # seconds — per-rsync operation timeout (WATCHER_RSYNC_TIMEOUT)
WATCHER_STREAM_RETENTION_DAYS=7 # days — stream entries older than this are trimmed (0 = disabled)
WATCHER_VOICES_DIR=/cache/voices
WATCHER_WORK_DIR=/work_remote
WATCHER_SYNTH_CONCURRENCY=1     # always 1 in v1 (GPU OOM safety)
