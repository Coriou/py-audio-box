services:
  toolbox:
    build:
      context: .
      dockerfile: Dockerfile
    image: voice-tools:latest
    working_dir: /app
    volumes:
      - ./:/app
      - ./work:/work
      - ./cache:/cache
    environment:
      - PYTHONUNBUFFERED=1
      - PYTHONDONTWRITEBYTECODE=1
      - REDIS_URL=${REDIS_URL:-redis://host.docker.internal:6379/0}
      # Rollout gate for Qwen3 CustomVoice commands in voice-synth.
      # Override per run: QWEN3_ENABLE_CUSTOMVOICE=0 ./run voice-synth ...
      - QWEN3_ENABLE_CUSTOMVOICE=${QWEN3_ENABLE_CUSTOMVOICE:-1}
      # Force HuggingFace to use the standard downloader (writes directly into
      # /cache mount) rather than the xet/XetHub protocol which writes large
      # temp files into the container's /tmp overlay and can exhaust its space.
      - HF_HUB_DISABLE_XET_TRANSPORT=1
    tty: true
    stdin_open: true
